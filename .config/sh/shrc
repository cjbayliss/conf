#!/bin/sh

# alias stuff
alias ix="curl -F 'f:1=<-' ix.io"
alias poweroff="sudo /sbin/poweroff"
alias wget="wget --no-hsts"
# i once removed this having forgot how slow debian's site-lisp is -_-
alias emacs="emacs --no-site-lisp"

# # FIXME: this only works on linux systems & shouldn't be an alias
# alias randstring="[ $(cat /proc/sys/kernel/random/entropy_avail) -gt 200 ] &&
#                   tr -dc '[0-9A-Za-z~\!\@\#$%^&*()_+]' </dev/urandom | fold -w 25 | head -n 10 ||
#                   printf \"WTF is wrong with your system?\n\""

# make startx use $XDG_CONFIG_HOME/x11/xsession
alias startx="xinit $XDG_CONFIG_HOME/x11/xsession -- vt$(tty | tail -c2)"

# FIXME: needs more testing!!
# setup a PS1 that *should* work in any POSIX compliant shell
__git_prompt() {
    BRANCH="$(git branch 2>/dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/ [\1]/')"
    STATUS="$(git status --short 2>/dev/null | sed 's/^ //g' | cut -d' ' -f1 | sort -u | tr -d '\n' | sed 's/\(.*\)/[\1]/')"
    printf "%s%s" "$BRANCH" "$STATUS"
}
PS1="$USER@${HOSTNAME:=$(hostname)}:\$(pwd | sed 's/\/home\/'$USER'/~/')\$(__git_prompt)> "

# common history file
HISTFILE="$XDG_DATA_HOME/history"

# ksh wants to delete history by default, rein it in
[ -n "$KSH_VERSION" ] && HISTSIZE=100000

# cleanup on exit
__cleanup() {
    rmdir ~/*
    rm ~/.*hist*
    rm ~/.lesshst
    rm ~/.viminfo
    rm -rf ~/.cache
    rm -rf ~/.w3m
    # delete duplicate lines & line starting with space
    awk '!/^ /&&!x[$0]++' "$XDG_DATA_HOME/history" > "$XDG_CACHE_HOME/cleaned_history" \
        && mv "$XDG_CACHE_HOME/cleaned_history" "$XDG_DATA_HOME/history"
    clear
}

trap __cleanup EXIT
