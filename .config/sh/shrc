#!/bin/sh

# alias stuff
alias grep="grep --color=auto"
alias ls="ls -h --color=auto"
alias ip="ip -c"
[ ! -f "$(which htop)" ] && alias htop="free -h; echo; uptime; echo; ps au"
alias ix="curl -F 'f:1=<-' ix.io"
alias poweroff="sudo /sbin/poweroff"
alias wget="wget --no-hsts"
# i once removed this having forgot how slow debian's site-lisp is -_-
alias emacs="emacs --no-site-lisp"
alias firefox="HOME=$XDG_CONFIG_HOME/naughty-program firefox"

# FIXME: this will only work on linux systems
alias randstring="[ $(cat /proc/sys/kernel/random/entropy_avail) -gt 200 ] &&
                  tr -dc '[0-9A-Za-z~\!\@\#$%^&*()_+]' </dev/urandom | fold -w 25 | head -n 10 ||
                  printf \"WTF is wrong with your system?\n\""

# so uh, yeeaaaaah... https://github.com/tmux/tmux/issues/142
alias tmux="tmux -f $XDG_CONFIG_HOME/tmux/tmux.conf"

# make startx use $XDG_CONFIG_HOME/x11/xsession
alias startx="startx $XDG_CONFIG_HOME/x11/xsession"

# setup a PS1 that *should* work in any POSIX compliant shell
PS1="$USER@${HOSTNAME:=$(hostname)}:\$(pwd | sed 's/\/home\/'$USER'/~/')\$(git branch 2>/dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/ [\1]/')> "

# cleanup on exit
__cleanup() {
    rmdir ~/*
    rm ~/.*hist*
    rm ~/.lesshst
    rm ~/.viminfo
    rm -rf ~/.w3m
    clear
}

trap __cleanup EXIT

# everything up until here should work in any POSIX shell ðŸ™‚
if [ -n "$BASH_VERSION" ]; then
    # append to histfile, don't duplicate, unlimit hist size, set histfile path
    shopt -s histappend
    HISTCONTROL=ignoreboth
    HISTSIZE=-1
    HISTFILESIZE=-1
    mkdir -p "$XDG_DATA_HOME/bash"
    HISTFILE="$XDG_DATA_HOME/bash/history"

    # check the window size after each command and, if necessary, update the values
    # of LINES and COLUMNS.
    shopt -s checkwinsize

    # better completion (imo)
    bind "set colored-completion-prefix on"
    bind "set colored-stats on"
    bind "set menu-complete-display-prefix on"
    bind "set show-all-if-ambiguous on"
    bind "set completion-query-items 0"
    bind "TAB:menu-complete"
    bind "\"\e[Z\": menu-complete-backward"
fi
